---
title: "GRP 2018 Cut Off"
author: "Aashish"
date: "7 September 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## ResultSet


```{r cars}
library(xlsx)
library(dplyr)

g_data_root <- "."
g_geresults_folder <- "rawresults"

## Range Version 1
g_tech_cut_l1 <- 40
g_tech_cut_l2 <- 50
g_tech_cut_l3 <- 25
g_tech_cut_l4 <- 100

g_apti_cut_l1 <- 75
g_apti_cut_l2 <- 50
g_apti_cut_l3 <- 85
g_apti_cut_l4 <- 95


## Range Version 2
###  DEV
g_tech_cut_l1 <- 35
g_apti_cut_l1 <- 75

g_tech_cut_l2 <- 50
g_apti_cut_l2 <- 50

### CS
g_tech_cut_l3 <- 15
g_apti_cut_l3 <- 85

g_tech_cut_l4 <- 100
g_apti_cut_l4 <- 95

g_max_marks_apti <- 40
g_programming_pct_to_use <- 22.8571

  heresultspath = paste( g_data_root , g_geresults_folder , sep = "/")
  files <- list.files(path=heresultspath, pattern="*.xls", full.names=T, recursive=FALSE)
  
  cutoff_list <- do.call(rbind,lapply(files, function(x) {
      res <- read.xlsx(x,1)
      
      v1 <- res %>% select(Name, Email, Institute, CGPA.Percentage, Phone.Number, Degree, Report.Access.URL, Programming..350.0. , Technical.Dev.Medium, Technical.Dev.Easy, Technical.Dev.C...Easy , Aptitude.Medium, Aptitude.Easy)
      
      names(v1) <- c("name", "email" ,  "institute" , "cgpa" , "phone" , "degree" , "url" , "programming"  , "techmed" , "techeasy" , "techcpp" , "aptmed" , "apteasy")
      
      v2 <- v1 %>% mutate ( programming = as.numeric(levels(programming))[programming] , 
                            aptmed = as.numeric(levels(aptmed))[aptmed],
                            apteasy = as.numeric(levels(apteasy))[apteasy],
                            techmed = as.numeric(levels(techmed))[techmed],
                            techeasy = as.numeric(levels(techeasy))[techeasy],
                            techcpp = as.numeric(levels(techcpp))[techcpp] ,
                            techpct = (programming * g_programming_pct_to_use / 100 ) + techmed + techeasy + techcpp,
                            apctpct = (apteasy + aptmed) * 100 / g_max_marks_apti ,
                            techaptpct = (techmed +techeasy ) * 100 / 15,  
                            allocation = ifelse ( (programming >=200 ) | (apctpct >= g_apti_cut_l1 & techpct >= g_tech_cut_l1) | (apctpct >= g_apti_cut_l2 & techpct >= g_tech_cut_l2) , "Dev" , 
                                                  ifelse ( apctpct >= 85 & techaptpct >= 80 , "CS" , "No")
                                                  ),
                            filename = basename(x)
                            ) 

      v3 <- v2 %>% mutate( allocation = ifelse( allocation == "CS" , 
			ifelse( grepl('_igdtuw_|_mait_', filename), "CS", "No"),
			allocation)) 

      
            return(v3)
  }))

output_file <- format(Sys.time(), "cutoff_list-%Y%m%d-%H%M%S.csv")
write.table(cutoff_list, output_file, sep="," , row.names = F)

```

